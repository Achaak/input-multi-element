function InputMultiElement(){var inputMultiElementDOM=undefined;var textareaDOM=$('<textarea class="ime-text-zone activate"></textarea>');var opts={maxElement:1000000};function init(_elem,_opts){inputMultiElementDOM=$(_elem);inputMultiElementDOM.empty();inputMultiElementDOM.addClass("input-multi-element");$.extend(opts,_opts);inputMultiElementDOM.append(textareaDOM);bindInputMultiElement()}
function bindInputMultiElement(){textareaDOM.focusout(function(_e){var _target=$(_e.currentTarget);var _value=_target.val();if(_value!=""){setElement(_value);clearTextZone()}});textareaDOM.keydown(function(_e){if(_e.keyCode==13){_e.preventDefault();var _target=$(_e.currentTarget);var _value=_target.val();if(_value!=""){setElement(_value);clearTextZone()}}
else if(_e.keyCode==8){var _target=$(_e.currentTarget);var _value=_target.val();if(_value==""){deleteLastElement()}}});inputMultiElementDOM.click(function(_e){if(!$(_e.target).closest(".ime-elem").length)
textareaDOM.focus()})}
function clearTextZone(){textareaDOM.val("")}
function setElement(_text,_index){if(getNbElements()<opts.maxElement){var _newElement=$("<div class='ime-elem'><span class='ime-text'>"+_text+"</span><span class='ime-delete'>Ã—</span></div>");_newElement.find(".ime-delete").click(function(_e){var _target=$(_e.currentTarget);_target.closest(".ime-elem").remove();onDeleteElement()});_newElement.find(".ime-text").click(function(_e){if($(_e.target).hasClass("ime-textarea-elem"))
return!1;var _target=$(_e.currentTarget);var _value=_target.text()
var _textareaElemDOM=$("<textarea class='ime-textarea-elem'>"+_value+"</textarea>");_target.html(_textareaElemDOM);_textareaElemDOM.select();_textareaElemDOM.focusout(function(_e){var _target=$(_e.currentTarget);var _value=_target.val();updateElementsById(_value,_target.closest(".ime-elem").index())});_textareaElemDOM.keydown(function(_e){if(_e.keyCode==13){_e.preventDefault();var _target=$(_e.currentTarget);var _value=_target.val();updateElementsById(_value,_target.closest(".ime-elem").index())}})});if(!_index&&_index!=0){_newElement.insertBefore(textareaDOM)}
else{var _elementAfter=$(inputMultiElementDOM.find(".ime-elem")[_index]);if(_elementAfter.length)_newElement.insertBefore(_elementAfter);else _newElement.insertBefore(textareaDOM)}
onSetElement(_newElement)}}
function setElements(_texts,_index){for(var i=0;i<_texts.length;i++){if(!_index&&_index!=0)
setElement(_texts[i]);else setElement(_texts[i],(_index+i))}}
function deleteLastElement(){var _elem=inputMultiElementDOM.find('.ime-elem').last();if(_elem.length){_elem.remove();onDeleteElement()}}
function deleteElementById(_index){var _elem=inputMultiElementDOM.find('.ime-elem')[_index];try{_elem.remove();onDeleteElement()}catch(_e){}}
function deleteElementsByValue(_value){for(var i=0;i<inputMultiElementDOM.find(".ime-elem").length;i++){var _elemDOM=$(inputMultiElementDOM.find(".ime-elem")[i]);if(_elemDOM.find(".ime-text").text()==_value)
deleteElementById(i)}}
function updateElementsById(_value,_index){var _elemDOM=$(inputMultiElementDOM.find('.ime-elem')[_index]);if(_elemDOM.length){_elemDOM.find('.ime-text').text(_value);onUpdateElement(_elemDOM)}}
function updateElementsByValue(_newValue,_lastValue){for(var i=0;i<inputMultiElementDOM.find(".ime-elem").length;i++){var _elemDOM=$(inputMultiElementDOM.find(".ime-elem")[i]);if(_elemDOM.find(".ime-text").text()==_lastValue){_elemDOM.find(".ime-text").text(_newValue)
onUpdateElement(_elemDOM)}}}
function getElements(){var _elemList=[];for(var i=0;i<inputMultiElementDOM.find(".ime-elem").length;i++){var _elemDOM=$(inputMultiElementDOM.find(".ime-elem")[i]);_elemList.push(_elemDOM.find(".ime-text").text())}
return _elemList}
function getElementsDOM(){var _elemList=[];for(var i=0;i<inputMultiElementDOM.find(".ime-elem").length;i++){var _elemDOM=$(inputMultiElementDOM.find(".ime-elem")[i]);_elemList.push(_elemDOM)}
return _elemList}
function getElementById(_index){var _elemDOM=$(inputMultiElementDOM.find(".ime-elem")[_index]);if(_elemDOM.length)
return _elemDOM.find(".ime-text").text()}
function getElementDOMById(_index){var _elemDOM=$(inputMultiElementDOM.find(".ime-elem")[_index]);if(_elemDOM.length)
return _elemDOM}
function getNbElements(){return inputMultiElementDOM.find(".ime-elem").length}
function nbElementByValue(_value){var cptElement=0;for(var i=0;i<inputMultiElementDOM.find(".ime-elem").length;i++){var _elemDOM=$(inputMultiElementDOM.find(".ime-elem")[i]);if(_elemDOM.find(".ime-text").text()==_value){cptElement++}}
return cptElement}
function hasElement(_value){return(nbElementByValue(_value)?!0:!1)}
function activateTextZone(_bool){textareaDOM[(_bool?"addClass":"removeClass")]("activate")}
function onSetElement(_elem){inputMultiElementDOM.trigger("ime:element:add",{element:_elem,text:_elem.find(".ime-text").html(),index:_elem.index()});if(getNbElements()>=opts.maxElement)activateTextZone(!1)}
function onDeleteElement(){inputMultiElementDOM.trigger("ime:element:delete");if(getNbElements()<opts.maxElement)activateTextZone(!0)}
function onUpdateElement(_elem){inputMultiElementDOM.trigger("ime:element:update",{element:_elem,text:_elem.find(".ime-text").html(),index:_elem.index()})}
return{"init":function(_elem,_opts){init(_elem,_opts)},"setElement":function(_text,_index){setElement(_text,_index)},"setElements":function(_texts,_index){setElements(_texts,_index)},"getElements":function(){return getElements()},"getElementsDOM":function(){return getElementsDOM()},"getElementById":function(_id){return getElementById(_id)},"getElementDOMById":function(_id){return getElementDOMById(_id)},"getNbElements":function(){return getNbElements()},"deleteLastElement":function(){deleteLastElement()},"deleteElementById":function(_id){deleteElementById(_id)},"deleteElementsByValue":function(_value){deleteElementsByValue(_value)},"updateElementsById":function(_value,_id){updateElementsById(_value,_id)},"updateElementsByValue":function(_newValue,_lastValue){updateElementsByValue(_newValue,_lastValue)},"hasElement":function(_value){return hasElement(_value)},"nbElementByValue":function(_value){return nbElementByValue(_value)},"activateTextZone":function(_bool){return activateTextZone(_bool)},"clearTextZone":function(){clearTextZone()}}}